<!-- 
    Caspio Loading Spinner Block
    This template provides a loading spinner to display while Caspio DataPages are loading.
    Include this template in your pages that use Caspio DataPages.
-->

<div class="caspio-spinner-block" id="caspio-loading-spinner">
    <div class="caspio-spinner"></div>
    <p class="mt-3">Loading data from Caspio...</p>
</div>

<script>
    // Hide the spinner when Caspio content is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Function to check if Caspio content is loaded
        function checkCaspioLoaded() {
            // Look for common Caspio elements
            if (document.querySelector('.cbResultSetTable') || 
                document.querySelector('.cbSearchForm') || 
                document.querySelector('.cbDetailView')) {
                // Caspio content is loaded, hide the spinner
                const spinner = document.getElementById('caspio-loading-spinner');
                if (spinner) {
                    spinner.style.display = 'none';
                }
                return true;
            }
            return false;
        }

        // Check immediately
        if (!checkCaspioLoaded()) {
            // Set up an observer to watch for Caspio content
            const observer = new MutationObserver(function(mutations) {
                if (checkCaspioLoaded()) {
                    // Content loaded, disconnect the observer
                    observer.disconnect();
                }
            });

            // Start observing the document body for changes
            observer.observe(document.body, { 
                childList: true, 
                subtree: true 
            });

            // Set a timeout to hide the spinner after 10 seconds regardless
            // This prevents the spinner from showing indefinitely if there's an issue
            setTimeout(function() {
                const spinner = document.getElementById('caspio-loading-spinner');
                if (spinner) {
                    spinner.style.display = 'none';
                }
                observer.disconnect();
            }, 10000);
        }
    });
</script>